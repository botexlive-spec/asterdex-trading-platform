<!DOCTYPE html>
<html>
<head>
    <title>Test Admin Login</title>
</head>
<body>
    <h1>Admin Login Test</h1>
    <button onclick="testLogin()">Test Admin Login</button>
    <button onclick="checkStorage()">Check localStorage</button>
    <button onclick="testAPI()">Test Admin API</button>
    <pre id="output"></pre>

    <script>
        const log = (msg) => {
            const output = document.getElementById('output');
            output.textContent += msg + '\n';
            console.log(msg);
        };

        async function testLogin() {
            try {
                log('üîê Testing admin login...');

                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@finaster.com',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                log('‚úÖ Login Response:');
                log(JSON.stringify(data, null, 2));

                // Store in localStorage like the app does
                localStorage.setItem('auth_token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));

                log('\nüì¶ Stored in localStorage');
                log('Token length: ' + data.token.length);
                log('User role: ' + data.user.role);

            } catch (error) {
                log('‚ùå Error: ' + error.message);
            }
        }

        function checkStorage() {
            log('\nüîç Checking localStorage...');

            const token = localStorage.getItem('auth_token');
            const userStr = localStorage.getItem('user');

            log('Has token: ' + !!token);
            log('Token preview: ' + (token ? token.substring(0, 50) + '...' : 'NONE'));

            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    log('\n‚úÖ Parsed user object:');
                    log('- ID: ' + user.id);
                    log('- Email: ' + user.email);
                    log('- Role: ' + user.role);
                    log('- Has role field: ' + ('role' in user));
                    log('- All keys: ' + Object.keys(user).join(', '));

                    log('\nüîí Role Check:');
                    log('- user.role === "admin": ' + (user.role === 'admin'));
                    log('- user.role === "superadmin": ' + (user.role === 'superadmin'));
                    log('- Actual role value: "' + user.role + '"');
                    log('- Role type: ' + typeof user.role);

                } catch (e) {
                    log('‚ùå Failed to parse user: ' + e.message);
                }
            } else {
                log('‚ùå No user in localStorage');
            }
        }

        async function testAPI() {
            log('\nüåê Testing admin API...');

            const token = localStorage.getItem('auth_token');
            if (!token) {
                log('‚ùå No token found. Please login first.');
                return;
            }

            try {
                const response = await fetch('http://localhost:3001/api/admin/analytics/overview', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                if (!response.ok) {
                    const error = await response.json();
                    log('‚ùå API Error: ' + JSON.stringify(error));
                } else {
                    const data = await response.json();
                    log('‚úÖ API Response:');
                    log('- Total users: ' + data.total_users);
                    log('- Total revenue: $' + data.total_revenue);
                }
            } catch (error) {
                log('‚ùå Request failed: ' + error.message);
            }
        }
    </script>
</body>
</html>
